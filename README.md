# REST API For Users Book Review (Backend FastAPI)

A RESTful backend for a book review application built with FastAPI, SQLModel/SQLAlchemy (async), PostgreSQL, Redis, and Celery for background e-mail tasks.
It is a scalable REST API built with FastAPI that powers a book review web service. It supports user authentication, book CRUD operations, review submissions, and aggregation of ratings while off-loading background tasks using Celery with Redis.
Designed for clean architecture, asynchronous job processing and easy integration with any front-end or mobile client.
## Overview

- App name: `myfastapiproject`
- API entrypoint: `src` package (the `app` instance is defined in `src/__init__.py`).
- API base path: `/api/v1` (docs available at `/api/v1/docs` and `/api/v1/redoc`).
- Key features: user signup / login (JWT), email verification, password reset, CRUD for books, book reviews, background emails via Celery + Redis, Alembic migrations.

## Requirements

- Python see [pyproject.toml](./pyproject.toml) — this project lists `requires-python = ">=3.13"` in `pyproject.toml`.
- PostgreSQL (or compatible DB) accessible via `DATABASE_URL` (asyncpg driver expected).
- Redis for Celery broker/result backend (default `redis://localhost:6379/0`).
- See [requirements.txt](./requirements.txt) for Python dependencies (FastAPI, uvicorn, sqlmodel, sqlalchemy, celery, fastapi-mail, etc.).

## Environment

Create a `.env` file at the project root with the following variables (example):

```
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/bookly_db
JWT_SECRET=your_jwt_secret_here
JWT_ALGORITHM=HS256
REDIS_URL=redis://localhost:6379/0
MAIL_USERNAME=your-smtp-username
MAIL_PASSWORD=your-smtp-password
MAIL_FROM=no-reply@yourdomain.com
MAIL_PORT=587
MAIL_SERVER=smtp.yourmailserver.com
MAIL_FROM_NAME=Bookly
MAIL_STARTTLS=true
MAIL_SSL_TLS=false
USE_CREDENTIALS=true
VALIDATE_CERTS=true
DOMAIN=localhost:8000
```

Notes:
- `DOMAIN` is used to build verification/reset links (e.g. `http://{DOMAIN}/api/v1/auth/verify/...`).
- `REDIS_URL` is used as both the Celery broker and result backend.

## Quickstart (Windows - cmd.exe)

1. Create and activate a virtual environment:

```cmd
pip install uv
.venv\Scripts\activate
```

2. Install dependencies:

```cmd
uv pip install -r requirements.txt
```

3. Create `.env` (see template above) and ensure your PostgreSQL and Redis instances are running.

4. Run database migrations with Alembic:

```cmd
alembic upgrade head
```

If you need to create an autogenerated migration after model changes:

```cmd
alembic revision --autogenerate -m "describe change"
alembic upgrade head
```

5. (Optional) Start a Celery worker (in a separate terminal). The Celery app object is `celery_app` in `src/celery_tasks.py`:

```cmd
celery -A src.celery_tasks.celery_app worker -l info
```

6. Run the FastAPI server:

```cmd
uv run fastapi dev src/
```

Open docs at: http://localhost:8000/api/v1/docs

## Project structure (high level)

- `src/` — application package
	- `__init__.py` — FastAPI `app` instance and router registration
	- `auth/` — authentication routes, schemas, services
	- `books/` — book routes, schemas, services
	- `reviews/` — review routes
	- `db/` — database engine, session, models
	- `celery_tasks.py` — Celery tasks and configuration
	- `mail.py` — email helpers and FastMail configuration
	- `config.py` — settings (Pydantic Settings / .env)
	- `middleware.py`, `errors.py` — middleware & centralized error handling

- `alembic.ini`, `migrations/` — Alembic migration scripts
- `requirements.txt`, `pyproject.toml` — dependency metadata

## Testing

This project contains pytest tests. To run tests:

```cmd
pytest -q
```

If tests need a running DB/Redis, either configure test DB credentials in `.env` or use test fixtures provided in `src/tests`.

## Notes & tips

- App import path for ASGI servers: `src:app` (the package `src` exposes the `app` FastAPI instance in `__init__.py`).
- Docs are mounted under `/api/v1/docs` by default.
- Celery tasks use settings from `src.config.Config` and `REDIS_URL` as the broker.
- Database initialization uses async SQLModel and async engine (see `src/db/main.py`), so the database must be reachable with an async driver (e.g., `asyncpg`).

## Contributing

1. Fork the repo
2. Create a feature branch
3. Run tests and linters locally
4. Open a PR with a clear description


## License

This project is licensed under the MIT License. See the [LICENSE](./LICENSE) file at the repository root for the full license text.


---


Author: [mujtabaalmas](https://github.com/mujtabaalmas)

